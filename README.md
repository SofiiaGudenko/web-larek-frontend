# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображения данных на странице,
- слой данных, отвечает за хранения и изменение данных,
- презентер, отвечает за связь представления и данных.

## Базовый код

### 1. Класс Api

Отвечает за работу запросов к серверу, содержит в себе логику отправки запросов. Его функции: получение и отправление данных на сервер, принимает такие аргументы:

baseUrl: string // базовая ссылка  
options: RequestInit = {} // настройки запроса Класс  
handleResponse() // проверяет ответ от сервера  

Методы:
- 'get' - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- 'post' - выполняет 'POST' запрос по умолчанию, но метод запроса может быть переопределен заданием третьего параметра при вызове

### 2. Класс EventEmitter

Данный класс позволяет отправлять и подписываться на события, происходящие в системе. Имеет следующие методы:

- 'on' - подписывает на событие
- 'off'- отписывает от события
- 'emit'- инициализация события
- 'trigger' - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### 3. Класс Model

Класс Model предназначен для взаимодействия с серверной частью через экземпляр класса Api. Он служит посредником между API и остальными частями приложения, обрабатывая данные, полученные от API, и предоставляя их в нужном формате.

Свойства:

- api: Api — экземпляр класса Api, используемый для отправки запросов к серверу.  

Конструктор:
- constructor(api: Api) — принимает экземпляр Api и сохраняет его в свойство api, чтобы использовать для запросов к серверу.

Методы:
- 'async getProducts(): Promise<IProduct[]>' — выполняет GET-запрос к эндпоинту '/product/' с использованием экземпляра Api. Возвращает массив продуктов response.items при успешном выполнении запроса. В случае ошибки выводит сообщение об ошибке в консоль и возвращает пустой массив.

### 4. Класс Component

Класс Component отвечает за управление отображением каталога продуктов на странице и взаимодействие с модальным окном для отображения информации о продуктах. Он связывает данные, полученные через Model, с их визуализацией на странице.  

Конструктор:

- constructor(model: Model, catalogContainer: HTMLElement, modal: Modal) — принимает экземпляр Model для работы с данными, HTML-элемент для размещения каталога продуктов и экземпляр Modal для отображения информации о продуктах. Сохраняет их в соответствующие свойства.  

Методы:

- 'async loadAndRenderProducts()' — Получает список продуктов, используя метод getProducts() класса Model. Передает полученные данные в метод renderProducts() для их визуализации на странице.
- 'private renderProducts(products: IProduct[])' — Вспомогательный метод для отрисовки карточек продуктов. Вызывает метод render() у каждого объекта Card для получения HTML-элемента карточки.
Добавляет созданные карточки в catalogContainer.


## Описание классов модели представления

### 1. Класс Card

Класс Card отвечает за создание и отображение карточки товара в каталоге. Он связывает данные о товаре с его визуальным представлением на странице, а также предоставляет возможность открытия модального окна с подробной информацией о товаре.

Конструктор:
- constructor(product: IProduct, modal: Modal): Принимает объект product с информацией о товаре и экземпляр modal. Сохраняет их в соответствующих полях.

Методы:
- render(): HTMLElement: Создает и возвращает HTML-элемент, представляющий карточку товара.
Использует шаблон с идентификатором #card-catalog для создания карточки.
Заполняет элементы карточки (название, категорию, изображение и цену) данными из product.
Добавляет обработчик события click на карточку, чтобы при клике открывалось модальное окно с подробной информацией о товаре, используя метод modal.open().

### 2. Класс Modal

Класс Modal отвечает за отображение модального окна с подробной информацией о товаре и за добавление или удаление товаров из корзины. Он управляет взаимодействием с корзиной и обеспечивает динамическое обновление содержимого модального окна в зависимости от состояния товара.  

Конструктор:

- constructor(modalElementId: string, basket: Basket): Принимает идентификатор модального окна и экземпляр корзины.
Инициализирует modalElement, closeButton, и contentElement на основе переданного modalElementId.
Сохраняет экземпляр корзины basket для управления взаимодействием с товарами.
Вызывает метод initEvents для добавления обработчиков событий.

Методы:

- 'initEvents()': Добавляет обработчики событий для закрытия модального окна.
- 'open(product: IProduct)': Открывает модальное окно с информацией о конкретном товаре.
- 'close()': Закрывает модальное окно.


### 3. Класс OrderForm
Класс OrderForm управляет процессом оформления заказа. Он отвечает за выбор способа оплаты, ввод адреса доставки, переход к вводу контактных данных (email и телефон), а также за подтверждение оплаты и отображение сообщения об успешном завершении заказа.

Конструктор:

- constructor(modalElementId: string, basket: Basket): Принимает идентификатор модального окна и экземпляр корзины.
Инициализирует элементы управления формы на основе переданного modalElementId.
Сохраняет экземпляр корзины basket.
Вызывает метод initEvents для добавления обработчиков событий.

Методы:

- 'initEvents()': Добавляет обработчики событий для закрытия окна, выбора способа оплаты, ввода адреса и нажатия на кнопку "Далее".

- 'open()': Открывает модальное окно, вызывая метод resetForm для очистки данных и добавляя класс 'modal_active' для отображения окна.

- 'close()': Закрывает модальное окно, убирая класс 'modal_active'.

- 'selectPaymentMethod(button: HTMLButtonElement)': Обрабатывает выбор способа оплаты.

- 'updateButtonState()': Обновляет состояние кнопки "Далее" в зависимости от заполненности адреса и выбранного способа оплаты.

- 'validateAndProceed()': Проверяет корректность введенных данных (адрес и способ оплаты).

- 'showStepTwo()': Отображает второй шаг формы — ввод контактных данных (email и телефон).

- 'validateEmailPhone(emailInput, phoneInput, payButton)': Проверяет заполненность полей email и телефона.

- 'showError(message: string)': Отображает сообщение об ошибке в форме.

- 'onPayment()': Обрабатывает нажатие кнопки "Оплатить".

- 'showSuccessMessage()': Отображает сообщение об успешном заказе.

- 'clearBasket()': Очищает содержимое корзины после оформления заказа.

- 'resetForm()': Сбрасывает форму заказа.

### 4. Класс Basket
Класс Basket управляет функциональностью корзины в приложении, включая добавление и удаление товаров, отображение списка товаров, подсчет общей суммы и взаимодействие с формой заказа.

Конструктор:

- constructor(modalElementId: string): Принимает идентификатор модального окна корзины.

Методы:

- 'initEvents()': Добавляет обработчики событий для закрытия окна корзины и нажатия на кнопку "Оформить".

- 'setOrderForm(orderForm: OrderForm)': Устанавливает экземпляр OrderForm, используемый для взаимодействия при оформлении заказа.

- 'onOrder()': Обрабатывает нажатие на кнопку "Оформить".

- 'getTotalAmount()': number: Возвращает общую сумму товаров в корзине.

- 'open()': Открывает корзину, вызывая метод renderBasketItems() для отображения товаров и добавляя класс 'modal_active'.

- 'close()': Закрывает корзину, убирая класс 'modal_active'.

- 'addToBasket(product: IProduct)': Добавляет товар в корзину.

- 'removeFromBasket(productId: number)': Удаляет товар из корзины по его идентификатору.

- 'clearBasket()': Очищает корзину после успешного оформления заказа.

- 'renderBasketItems()': Отображает товары, добавленные в корзину.

- 'createBasketItem(product: IProduct, index: number): HTMLElement': Создает HTML-элемент для отображения товара в корзине.

- 'updateTotal()': Обновляет отображение общей суммы товаров в корзине на основе текущего содержимого.

- 'updateCounter()': Обновляет отображение количества товаров в корзине на иконке корзины.

- 'isInBasket(productId: number): boolean': Проверяет, находится ли товар с указанным идентификатором в корзине.